<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kenya Trivia ‚Äî Interactive</title>
<style>
  :root{ --black:#111; --red:#d43b44; --green:#169158; --muted:#666; --card:#fff; --max-width:980px; }
  *{box-sizing:border-box}
  body{font-family:system-ui, -apple-system, "Segoe UI", Roboto, Arial; margin:0; background:#f6faf6; color:#111}
  header.flag{height:72px;display:flex;align-items:center;justify-content:center;
    background:
      linear-gradient(90deg,
        var(--black) 0 18%,
        #ffffff 18% 20%,
        var(--red) 20% 80%,
        #ffffff 80% 82%,
        var(--green) 82% 100%);
    position:sticky; top:0; z-index:50; box-shadow:0 6px 18px rgba(0,0,0,0.06)}
  .banner-label{background:transparent;padding:8px 16px;border-radius:9px;color:#fff;font-weight:800;font-size:1.15rem}
  .wrap{max-width:var(--max-width);margin:14px auto;padding:12px}
  .card{background:var(--card);border-radius:10px;padding:14px;margin-bottom:14px;box-shadow:0 6px 18px rgba(8,8,8,0.06)}
  .col-center{display:flex;flex-direction:column;align-items:center;justify-content:center}
  .lang-wrap{position:absolute;right:14px;top:12px}
  select{padding:6px;border-radius:6px;border:1px solid #ddd}
  .btn{background:var(--green);color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:700}
  .btn.ghost{background:#f0f0f0;color:#111}
  .btn.small{padding:6px 8px;font-size:0.9rem}
  .categories{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:12px}
  .cat-btn{padding:8px 12px;border-radius:999px;border:1px solid #e8e8e8;background:#fff;cursor:pointer}
  .cat-btn.active{background:var(--green);color:#fff;border-color:var(--green)}
  .carousel{display:flex;align-items:center;justify-content:center;gap:10px}
  .carousel-card{max-width:760px;background:#fff;padding:12px;border-radius:8px;box-shadow:0 6px 14px rgba(0,0,0,0.04);text-align:center;min-height:64px;display:flex;align-items:center;justify-content:center;transition:opacity .35s ease, transform .35s ease}
  .carousel-tip{margin-top:8px;text-align:center;color:var(--muted);font-weight:600}
  .progress-wrap{height:10px;background:#eee;border-radius:999px;overflow:hidden;margin:8px 0}
  .progress{height:100%;background:linear-gradient(90deg,var(--green),#44c07a);width:0%}
  .qbox{padding:12px;border-radius:8px;background:linear-gradient(#fff,#fbfff9)}
  .question{font-weight:800;margin:0 0 12px;text-align:center}
  .options{display:flex;flex-direction:column;gap:8px;align-items:center}
  .option{padding:12px;border-radius:8px;border:1px solid #e6e6e6;cursor:pointer;width:100%;max-width:760px;text-align:left;touch-action:manipulation;display:flex;justify-content:space-between;align-items:center;transition:background .18s,border-color .18s,transform .12s}
  .option:hover{transform:translateY(-2px)}
  .option.disabled{pointer-events:none;opacity:.85}
  .option.correct{background:#e6fff1;border-color:var(--green)}
  .option.wrong{background:#fff0f1;border-color:#e35b5b}
  .option.show-correct-skip{background:#fff7e6;border-color:#f5c542}
  .feedback-icon{font-weight:900;margin-left:12px;font-size:18px}
  .hint-btn{background:#fff;border:1px solid #ddd;padding:8px 12px;border-radius:8px;cursor:pointer}
  .fact{background:#f7fff8;border-left:4px solid var(--green);padding:10px;border-radius:6px;margin-top:12px;font-size:0.95rem}
  .actions{display:flex;justify-content:space-between;align-items:center;margin-top:12px;gap:8px;flex-wrap:wrap}
  .meta{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .forum .post{padding:8px;border:1px solid #eee;border-radius:8px;margin-bottom:8px;background:#fff}
  .chat {border:1px solid #eee;padding:12px;border-radius:8px;background:#fff;max-width:760px;margin:12px auto}
  .jmsg{font-size:0.92rem}
  .jnote{font-size:0.82rem;color:var(--muted)}
  footer{margin-top:12px;text-align:center;color:var(--muted);padding:10px}
  @media (max-width:820px){ .lang-wrap{position:static;margin-top:8px} }
  @media (max-width:600px){ :root{--max-width:420px} header.flag{height:56px} .banner-label{font-size:1rem} .wrap{padding:8px} .carousel-card{min-height:56px} .question{font-size:1rem} .option{padding:10px} .chat{max-width:100%} }
</style>
</head>
<body>
  <header class="flag"><div class="banner-label">Kenya Trivia</div></header>

  <div class="wrap">
    <!-- Intro + Language -->
    <div class="card" style="position:relative;padding-top:30px;text-align:center">
      <div class="lang-wrap">
        <label class="small" for="langSelect" id="langLabel">Language</label><br>
        <select id="langSelect" aria-label="Choose language"></select>
      </div>

      <div class="col-center">
        <h1 id="title">Test your knowledge of Kenya</h1>
        <p id="sub" style="font-weight:700">Short quizzes. Honest learning. Real Kenyan stories.</p>
        <p class="small" id="intro">Curated questions from Kenya‚Äôs pre-colonial, colonial and modern eras ‚Äî plus culture, language and food. Choose a category, pick a language, and press Start. Click an answer to lock it, use Hint for context ‚Äî press Next when ready.</p>
        <div style="display:flex;gap:8px;margin-top:12px;justify-content:center">
          <button id="startBtn" class="btn">Start 5-question run</button>
          <button id="funBtn" class="btn ghost" style="display:none">Quick Fun Facts</button>
        </div>
      </div>
    </div>

    <!-- Fun facts carousel (auto-load on page load) -->
    <div id="funWrap" class="card center" style="display:flex;flex-direction:column;align-items:center">
      <div style="display:flex;align-items:center;gap:8px;width:100%;justify-content:center">
        <button id="prevFact" class="btn ghost small" aria-label="previous fact">‚óÄ</button>
        <div id="carouselCard" class="carousel-card" aria-live="polite">Kenyan Quick surprising Facts</div>
        <button id="nextFact" class="btn ghost small" aria-label="next fact">‚ñ∂</button>
      </div>
      <div class="carousel-tip" id="carouselTip">Kenyan Quick surprising Facts ‚Äî curious facts that change every 4 seconds.</div>
    </div>

    <!-- Categories -->
    <div class="card center" style="flex-direction:column;text-align:center">
      <div class="small" id="chooseCatLabel">Choose a category ‚Äî sample question appears immediately</div>
      <div id="categoryRow" class="categories" style="margin-top:12px"></div>
    </div>

    <!-- Game area -->
    <div id="gameArea" class="card" style="display:block;scroll-margin-top:80px">
      <div class="progress-wrap" aria-hidden="true"><div id="progress" class="progress"></div></div>

      <div class="qbox">
        <div class="question" id="questionText">Pick a category to see a sample question.</div>
        <div id="options" class="options" role="listbox" tabindex="0"></div>

        <div style="display:flex;justify-content:center;gap:8px;margin-top:12px">
          <button id="hintBtn" class="hint-btn">Hint</button>
          <button id="voicePlay" class="btn ghost">üîä Play audio</button>
          <button id="voiceStop" class="btn ghost">‚èπ Stop</button>
        </div>

        <div class="actions">
          <div style="display:flex;gap:8px;align-items:center">
            <button id="prevBtn" class="btn ghost" disabled>Previous</button>
            <button id="nextBtn" class="btn ghost" disabled>Next</button>
            <button id="skipBtn" class="btn ghost">Skip (3/3)</button>
          </div>

          <div class="meta">
            <div class="small">Q <span id="qIndex">0</span>/5</div>
            <div class="small">Score: <span id="runningScore">0</span></div>
          </div>
        </div>

        <div id="hintArea" class="fact" style="display:none"></div>
      </div>

      <div id="resultArea" style="display:none;margin-top:12px"></div>
    </div>

    <!-- Chatbot Janjez -->
    <div class="card chat" style="text-align:center">
      <h3 style="text-align:center"><span style="display:inline-block;width:36px;height:36px;background:#eee;border-radius:8px;margin-right:8px;vertical-align:middle;text-align:center;line-height:36px">ü§ñ</span> Janjez ‚Äî Swahili & Sheng lessons</h3>
      <div id="jchat" style="min-height:120px;margin-bottom:8px;overflow:auto;max-height:200px;text-align:left;padding:8px;border-radius:6px;background:#fff">
        <div id="jintro" class="jnote">hey, jambo</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
        <input id="jinput" placeholder="Ask Janjez for a phrase or lesson (e.g., 'Teach me a Sheng greeting')" style="flex:1;padding:8px;border-radius:6px;border:1px solid #ddd">
        <button id="jsend" class="btn">Ask</button>
      </div>
      <div style="margin-top:8px;display:flex;gap:8px;align-items:center;flex-wrap:wrap;justify-content:center">
        <small>Sample prompts:</small>
        <button class="btn ghost jsample">Teach me 'good morning' in Swahili</button>
        <button class="btn ghost jsample">Give a Sheng greeting</button>
        <button class="btn ghost jsample">Explain 'Harambee'</button>
      </div>
      <div style="margin-top:8px;text-align:center">
        <button id="teachBtn" class="btn" style="display:none;background:var(--green);">Funza Janjez</button>
      </div>
    </div>

    <!-- Forum -->
    <div class="card forum" id="forumCard" style="text-align:center">
      <h3 id="forumTitle" style="text-align:center">Community Forum</h3>
      <p class="small" id="forumIntro">Write your question, proverb or word ‚Äî submissions go to admin for review.</p>
      <div style="display:flex;gap:8px;flex-direction:column;align-items:center;margin-top:8px">
        <input id="postCategory" placeholder="Category (e.g. Food, History, Sheng)" style="width:100%;max-width:720px;padding:8px;border-radius:6px;border:1px solid #ddd">
        <input id="postQuestion" placeholder="Write your question, proverb or word" style="width:100%;max-width:720px;padding:8px;border-radius:6px;border:1px solid #ddd">
        <input id="postAnswer" placeholder="Optional correct answer" style="width:100%;max-width:720px;padding:8px;border-radius:6px;border:1px solid #ddd">
        <div style="display:flex;gap:8px">
          <button id="submitPost" class="btn">Submit</button>
          <button id="postToForum" class="btn ghost">Post to Forum</button>
        </div>
        <div id="postMsg" class="small" style="margin-top:8px;color:var(--muted)"></div>
      </div>
      <div style="margin-top:12px">
        <h4 style="margin:6px 0;text-align:center">Forum Posts</h4>
        <div id="forumList"></div>
      </div>
    </div>

    <footer id="siteFooter" style="text-align:center">Made by Peter Jotham Matete (Bojack Msafiri) 2025</footer>
  </div>

<script>
/* Full-featured Kenya Trivia ‚Äî restore full questions & languages, with compact/mobile layout and requested UX.
   Defensive checks and ensured elements exist before attaching listeners.
*/

const LANGS = [ {code:'en', label:'English'}, {code:'sw', label:'Kiswahili'}, {code:'fr', label:'Fran√ßais'}, {code:'de', label:'Deutsch'}, {code:'es', label:'Espa√±ol'}, {code:'zh', label:'‰∏≠Êñá'}, {code:'ar', label:'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©'}, {code:'it', label:'Italiano'} ];

const UI = {
  en:{ title:"Test your knowledge of Kenya", sub:"Short quizzes. Honest learning. Real Kenyan stories.", intro:"Curated questions from Kenya‚Äôs pre-colonial, colonial and modern eras ‚Äî plus culture, language and food.", start:"Start 5-question run", hint:"Hint", skipLabel:"Skip", chooseCat:"Choose a category ‚Äî sample question appears immediately", forumTitle:"Community Forum", forumIntro:"Write your question, proverb or word ‚Äî submissions go to admin for review.", langLabel:"Language", play:"üîä Play audio", stop:"‚èπ Stop", carouselTip:"Kenyan Quick surprising Facts ‚Äî curious facts that change every 4 seconds." },
  sw:{ title:"Jaribu maarifa yako kuhusu Kenya", sub:"Majibu mafupi. Kujifunza kwa uaminifu. Hadithi halisi za Kenya.", intro:"Maswali kuhusu enzi za kabla ya ukoloni, ukoloni na Kenya ya kisasa ‚Äî utamaduni, lugha na vyakula.", start:"Anza mtihani wa maswali 5", hint:"Tip", skipLabel:"Ruka", chooseCat:"Chagua kitengo ‚Äî swali la mfano linaonekana mara moja", forumTitle:"Jukwaa la Jamii", forumIntro:"Andika swali lako, methali au neno ‚Äî itatumwa kwa admin kuangalia.", langLabel:"Lugha", play:"Sikiliza", stop:"Simamisha", carouselTip:"Mambo ya kushangaza kuhusu Kenya ‚Äî hubadilika kila baada ya sekunde 4." }
};

/* Full QUESTIONS array ‚Äî restored from earlier version. Each object contains translations where available. */
const QUESTIONS = [
  {id:101, category:'History', answer:0, translations:{en:{q:"Who led the Nandi resistance against colonial forces?",options:["Koitalel arap Samoei","Dedan Kimathi","Jomo Kenyatta","Jaramogi Oginga Odinga" ], hint:"Killed in 1905."}, sw:{q:"Nani aliongoza upinzani wa Nandi dhidi ya wakoloni?",options:["Koitalel arap Samoei","Dedan Kimathi","Jomo Kenyatta","Jaramogi Oginga Odinga" ], hint:"Aliuawa 1905."}}},
  {id:102, category:'History', answer:1, translations:{en:{q:"Which leader was executed in 1957 for leading the Mau Mau uprising?",options:["Koitalel arap Samoei","Dedan Kimathi","Jomo Kenyatta","Ronald Ngala"], hint:"Symbol of Mau Mau."}}},
  {id:103, category:'History', answer:2, translations:{en:{q:"Who became Kenya's first president at independence in 1963?",options:["Mwai Kibaki","Daniel arap Moi","Jomo Kenyatta","Tom Mboya"], hint:"Called Father of the Nation."}}},
  {id:104, category:'History', answer:3, translations:{en:{q:"Which politician was assassinated in 1969 and influenced early politics?",options:["Kibaki","Oginga Odinga","Kenyatta","Tom Mboya"], hint:"Major early leader."}}},
  {id:105, category:'History', answer:0, translations:{en:{q:"'Harambee' is best described as:",options:["A call for collective effort","A type of food","A political party","A traditional dance"], hint:"Used to start community projects."}}},

  {id:201, category:'Food', answer:0, translations:{en:{q:"Which dish is commonly considered Kenya's staple?",options:["Ugali","Pilau","Chapati","Githeri"], hint:"Made from maize flour."}}},
  {id:202, category:'Food', answer:3, translations:{en:{q:"What is 'Nyama choma'?",options:["A type of stew","A breakfast porridge","A sweet snack","Grilled meat"], hint:"Often social."}}},
  {id:203, category:'Food', answer:2, translations:{en:{q:"What side dish is typically served with nyama choma?",options:["Ugali","Githeri","Kachumbari","Mandazi"], hint:"Tomato-onion salad."}}},
  {id:204, category:'Food', answer:1, translations:{en:{q:"Which beverage is Kenya a major producer of?",options:["Black tea","Coffee","Cocoa","Vodka"], hint:"Tea estates are common."}}},
  {id:205, category:'Food', answer:0, translations:{en:{q:"What is 'Githeri'?",options:["A mix of maize and beans","A fish dish","A sweet pastry","A spicy sauce"], hint:"Home-cooked, nutritious."}}},

  {id:301, category:'Geography', answer:0, translations:{en:{q:"Which county is the largest by area in Kenya?",options:["Turkana","Nairobi","Mombasa","Kisumu"], hint:"Located in north."}}},
  {id:302, category:'Geography', answer:2, translations:{en:{q:"Which city is a major port on the Indian Ocean in Kenya?",options:["Nakuru","Eldoret","Mombasa","Kisumu"], hint:"Home of Fort Jesus."}}},
  {id:303, category:'Geography', answer:3, translations:{en:{q:"Which city sits on the shores of Lake Victoria?",options:["Nairobi","Mombasa","Eldoret","Kisumu"], hint:"Largest lake in Africa."}}},
  {id:304, category:'Geography', answer:1, translations:{en:{q:"Which town is famous for long-distance runners?",options:["Nakuru","Eldoret","Mombasa","Naivasha"], hint:"High altitude training."}}},
  {id:305, category:'Geography', answer:0, translations:{en:{q:"Where is the Kakamega Forest located?",options:["Western Kenya","Eastern Kenya","Northern Kenya","Central Kenya"], hint:"Tropical rainforest."}}},

  {id:401, category:'Language', answer:0, translations:{en:{q:"What language is commonly used as a lingua franca across Kenya?",options:["Swahili","Kikuyu","Luo","Kalenjin"], hint:"Also official."}}},
  {id:402, category:'Language', answer:0, translations:{en:{q:"What is 'Sheng'?",options:["An urban mixed dialect of Swahili and English","A traditional song","A dance","A type of food"], hint:"Common in Nairobi."}}},
  {id:403, category:'Language', answer:0, translations:{en:{q:"What does 'Harambee' literally encourage?",options:["Collective self-help","Individual work","Silence","Exile"], hint:"Rally community projects."}}},
  {id:404, category:'Language', answer:3, translations:{en:{q:"Which is an official language of Kenya besides English?",options:["Kikuyu","Luo","French","Swahili"], hint:"Widely used."}}},
  {id:405, category:'Language', answer:0, translations:{en:{q:"What mixes with Swahili to form Sheng?",options:["English","French","German","Italian"], hint:"Sheng blends Swahili and English."}}},

  {id:501, category:'Sheng', answer:0, translations:{en:{q:"What does Sheng phrase 'Niaje buda?' mean?",options:["How are you, bro?","Where are you?","No problem","See you later"], hint:"Casual greeting."}}},
  {id:502, category:'Sheng', answer:1, translations:{en:{q:"In Sheng, what does 'sawa' usually mean?",options:["Run fast","Okay / Fine","Eat now","Run away"], hint:"Used to agree."}}},
  {id:503, category:'Sheng', answer:2, translations:{en:{q:"Which group most influences Sheng?",options:["Older rural elders","Urban youth","Foreign diplomats","Farmers"], hint:"Nairobi street culture."}}},
  {id:504, category:'Sheng', answer:3, translations:{en:{q:"Which word means 'friend' in Sheng?",options:["Msee","Giriama","Koma","Buda"], hint:"Friendly address."}}},
  {id:505, category:'Sheng', answer:0, translations:{en:{q:"If someone says 'Niko poa' in Sheng, they mean:",options:["I'm fine","I'm running","I'm hungry","I'm busy"], hint:"Poa = good/cool."}}},

  {id:601, category:'Sports', answer:0, translations:{en:{q:"Which Kenyan marathoner broke the 2-hour barrier in an unofficial event?",options:["Eliud Kipchoge","Kipchoge Eliud","Paul Tergat","Wilson Kipsang"], hint:"Considered greatest marathoner."}}},
  {id:602, category:'Sports', answer:2, translations:{en:{q:"Which sport is national and popular in Kenya (world stage)?",options:["Rugby","Cricket","Athletics","Basketball"], hint:"Long-distance success."}}},
  {id:603, category:'Sports', answer:1, translations:{en:{q:"Kenya famously excels in which athletic discipline?",options:["Swimming","Distance running","Weightlifting","Sprinting"], hint:"Marathons and cross country."}}},
  {id:604, category:'Sports', answer:3, translations:{en:{q:"Which event takes place in the Maasai Mara attracting tourists?",options:["Formula 1","Great Wildebeest Migration","Carnival","Regatta"], hint:"Large animal migration."}}},
  {id:605, category:'Sports', answer:0, translations:{en:{q:"Which distance runner set multiple world records and is Kenyan?",options:["Eliud Kipchoge","Usain Bolt","Mo Farah","Haile Gebrselassie"], hint:"Marathon legend."}}},

  {id:701, category:'Music', answer:0, translations:{en:{q:"Who is a famous Kenyan musician known for 'Malaika' renditions?",options:["Fadhili William","Sauti Sol","Nyashinski","Eric Wainaina"], hint:"Composer of a beloved song."}}},
  {id:702, category:'Music', answer:1, translations:{en:{q:"Which modern group is known for Kenyan pop and Afro-fusion?",options:["The Parrots","Sauti Sol","Them","The Beatles"], hint:"Popular band."}}},
  {id:703, category:'Music', answer:2, translations:{en:{q:"What language often appears in Kenyan coastal music?",options:["Kikuyu","Swahili","Luo","Kalenjin"], hint:"Swahili Coast heritage."}}},
  {id:704, category:'Music', answer:3, translations:{en:{q:"What is 'benga'?",options:["A spice","A music style","A hat","A dance"], hint:"Guitar-driven Kenyan style."}}},
  {id:705, category:'Music', answer:0, translations:{en:{q:"Which is a popular Kenyan music festival?",options:["Blankets & Wine","Carnivore Fest","Womad","Glastonbury"], hint:"Urban live-music festival."}}},

  {id:801, category:'Politics', answer:2, translations:{en:{q:"Which year did Kenya gain independence?",options:["1950","1957","1963","1970"], hint:"Year of independence."}}},
  {id:802, category:'Politics', answer:0, translations:{en:{q:"Who is often called Kenya's first president?",options:["Jomo Kenyatta","Daniel arap Moi","Mwai Kibaki","Uhuru Kenyatta"], hint:"Father of the Nation."}}},
  {id:803, category:'Politics', answer:1, translations:{en:{q:"Which political movement resisted colonial rule in the 1950s?",options:["Harambee","Mau Mau","Kenya Kwanza","Kanu"], hint:"Armed uprising."}}},
  {id:804, category:'Politics', answer:3, translations:{en:{q:"Which document is Kenya's supreme law?",options:["Magna Carta","Universal Declaration","Kenyan Constitution","Bill of Rights"], hint:"Adopted 2010."}}},
  {id:805, category:'Politics', answer:0, translations:{en:{q:"Which Kenyan leader founded the Green Belt Movement?",options:["Wangari Maathai","Jomo Kenyatta","Mwai Kibaki","Raila Odinga"], hint:"Nobel laureate."}}},

  {id:901, category:'Culture', answer:0, translations:{en:{q:"Which community is renowned for beadwork and red garments?",options:["Maasai","Kalenjin","Luo","Kikuyu"], hint:"Distinctive beadwork."}}},
  {id:902, category:'Culture', answer:1, translations:{en:{q:"What is 'kanga'?",options:["Bead","A cloth with Swahili sayings","A drum","A type of stew"], hint:"Textile with messages."}}},
  {id:903, category:'Culture', answer:0, translations:{en:{q:"Which Kenyan writer is internationally acclaimed?",options:["Ng≈©gƒ© wa Thiong'o","Chinua Achebe","Wole Soyinka","Naguib Mahfouz"], hint:"Writes in Gikuyu and English."}}},
  {id:904, category:'Culture', answer:2, translations:{en:{q:"Which town is a UNESCO site with Swahili architecture?",options:["Nairobi","Mombasa","Lamu","Kisumu"], hint:"Old Swahili town."}}},
  {id:905, category:'Culture', answer:0, translations:{en:{q:"Which festival celebrates film and arts in Kenya?",options:["Kilifi Film Festival","Nairobi Film Festival","Ghetto Film Festival","Cultural Fest"], hint:"Coastal film event."}}}
];

const FUNFACTS = [
  {id:'f1', en:"Nairobi is Kenya‚Äôs capital and a major financial hub in East Africa.", sw:"Nairobi ni mji mkuu wa Kenya na kitovu cha fedha East Africa."},
  {id:'f2', en:"Mombasa is a historic port city on Kenya‚Äôs Indian Ocean coast and home to Fort Jesus.", sw:"Mombasa ni mji wa bandari wa kihistoria kwenye pwani ya Kenya."},
  {id:'f3', en:"Eliud Kipchoge is a Kenyan marathoner considered among the greatest ever.", sw:"Eliud Kipchoge ni mwanariadha wa marathon kutoka Kenya."},
  {id:'f4', en:"Wangari Maathai founded the Green Belt Movement and won the Nobel Peace Prize.", sw:"Wangari Maathai alianzisha Green Belt Movement na alipata Tuzo ya Amani ya Nobel."},
  {id:'f5', en:"Nyama choma (grilled meat) is a central social food in Kenya.", sw:"Nyama choma ni chakula cha kijamii nchini Kenya."},
  {id:'f6', en:"The Maasai are well-known for their beadwork and distinctive dress.", sw:"Wamaasai wanajulikana kwa uchoraji wa shanga na mavazi ya kipekee."},
  {id:'f7', en:"Lamu Town is a UNESCO World Heritage Site with old Swahili architecture.", sw:"Mji wa Lamu ni tovuti ya Urithi wa Dunia ya UNESCO."},
  {id:'f8', en:"Tea and coffee estates are important to Kenya's economy and exports.", sw:"Shamba za chai na kahawa ni muhimu kwa uchumi wa Kenya."},
  {id:'f9', en:"Ng≈©gƒ© wa Thiong'o is a celebrated Kenyan writer.", sw:"Ng≈©gƒ© wa Thiong'o ni mwandishi maarufu wa Kenya."},
  {id:'f10', en:"The Great Wildebeest Migration reaches parts of the Maasai Mara each year.", sw:"Uhamaji mkubwa wa nyumbu hupitia Maasai Mara kila mwaka."}
];

/* State and DOM refs */
let state = { lang:'en', category:'All', pool:[], game:[], selections:[], currentIndex:0, score:0, skipRemain:3, funIndex:0, funTimer:null, funPlaying:true, mode:'sample', janjezLearned:[] };

const langSelect = document.getElementById('langSelect');
const titleEl = document.getElementById('title');
const subEl = document.getElementById('sub');
const introEl = document.getElementById('intro');
const startBtn = document.getElementById('startBtn');
const funBtn = document.getElementById('funBtn');
const funWrap = document.getElementById('funWrap');
const carouselCard = document.getElementById('carouselCard');
const prevFactBtn = document.getElementById('prevFact');
const nextFactBtn = document.getElementById('nextFact');
const categoryRow = document.getElementById('categoryRow');
const chooseCatLabel = document.getElementById('chooseCatLabel');
const questionText = document.getElementById('questionText');
const optionsBox = document.getElementById('options');
const progressBar = document.getElementById('progress');
const qIndexEl = document.getElementById('qIndex');
const runningScoreEl = document.getElementById('runningScore');
const hintBtn = document.getElementById('hintBtn');
const hintArea = document.getElementById('hintArea');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const skipBtn = document.getElementById('skipBtn');
const resultArea = document.getElementById('resultArea');
const voicePlay = document.getElementById('voicePlay');
const voiceStop = document.getElementById('voiceStop');
const forumList = document.getElementById('forumList');
const postCategory = document.getElementById('postCategory');
const postQuestion = document.getElementById('postQuestion');
const postAnswer = document.getElementById('postAnswer');
const submitPost = document.getElementById('submitPost');
const postToForum = document.getElementById('postToForum');
const postMsg = document.getElementById('postMsg');
const langLabelEl = document.getElementById('langLabel');
const siteFooter = document.getElementById('siteFooter');
const jintro = document.getElementById('jintro');
const jchat = document.getElementById('jchat');
const jinput = document.getElementById('jinput');
const jsend = document.getElementById('jsend');
const jsamples = Array.from(document.querySelectorAll('.jsample'));
const teachBtn = document.getElementById('teachBtn');

/* Init */
function init(){
  LANGS.forEach(l=>{ const o=document.createElement('option'); o.value=l.code; o.textContent=l.label; langSelect.appendChild(o); });
  langSelect.value = state.lang; langSelect.addEventListener('change', ()=> setLanguage(langSelect.value));
  setLanguage(state.lang);
  renderCategories(); state.pool = QUESTIONS.slice(); showSampleForCategory('All'); renderFunFact(); startFunCarousel(); renderForum(); updateSkipLabel();
  if(startBtn) startBtn.addEventListener('click', ()=>{ prepareGame(); document.getElementById('gameArea').scrollIntoView({behavior:'smooth'}); renderQuestion(); });
  if(prevFactBtn) prevFactBtn.addEventListener('click', ()=>{ state.funIndex=(state.funIndex-1+FUNFACTS.length)%FUNFACTS.length; renderFunFact(); });
  if(nextFactBtn) nextFactBtn.addEventListener('click', ()=>{ state.funIndex=(state.funIndex+1)%FUNFACTS.length; renderFunFact(); });
  if(prevBtn) prevBtn.addEventListener('click', ()=>{ if(state.currentIndex>0){ state.currentIndex--; renderQuestion(); }});
  if(nextBtn) nextBtn.addEventListener('click', ()=>{ if(state.currentIndex < state.game.length-1){ state.currentIndex++; renderQuestion(); } else finishRun(); });
  if(skipBtn) skipBtn.addEventListener('click', onSkip); if(hintBtn) hintBtn.addEventListener('click', onHint);
  if(voicePlay) voicePlay.addEventListener('click', ()=> speakCurrent()); if(voiceStop) voiceStop.addEventListener('click', ()=> { window.speechSynthesis && window.speechSynthesis.cancel(); });
  if(submitPost) submitPost.addEventListener('click', onSubmitPost); if(postToForum) postToForum.addEventListener('click', onPostForum);
  if(jsend) jsend.addEventListener('click', onAskJanjez); jsamples.forEach(btn=> btn.addEventListener('click', ()=>{ jinput.value = btn.textContent; onAskJanjez(); }));
  if(teachBtn) teachBtn.addEventListener('click', onTeachJanjez);
  optionsBox.addEventListener('keydown', onOptionsKeydown); document.addEventListener('keydown', globalKeydown);
  setTimeout(()=> { if(jintro) jintro.textContent = 'niaje'; }, 3000);
}
init();

/* Translations for UI */
function setLanguage(code){ state.lang = code; const u = UI[code] || UI['en']; titleEl.textContent = u.title; subEl.textContent = u.sub; introEl.textContent = u.intro; hintBtn.textContent = u.hint; chooseCatLabel.textContent = u.chooseCat; forumTitle.textContent = u.forumTitle; forumIntro.textContent = u.forumIntro; langLabelEl.textContent = u.langLabel; voicePlay.textContent = u.play; voiceStop.textContent = u.stop; document.getElementById('carouselTip').textContent = u.carouselTip; siteFooter.textContent = 'Made by Peter Jotham Matete (Bojack Msafiri) 2025'; updateSkipLabel(); renderCategories(); renderFunFact(); renderForum(); if(state.mode==='game' && state.game.length) renderQuestion(); else showSampleForCategory(state.category); }

/* Categories */
function getCategories(){ return ['All', ...Array.from(new Set(QUESTIONS.map(q=>q.category)))]; }
function renderCategories(){ categoryRow.innerHTML=''; getCategories().forEach(cat=>{ const b=document.createElement('button'); b.className='cat-btn'+(state.category===cat?' active':''); b.textContent=cat; b.addEventListener('click', ()=> selectCategory(cat), {passive:true}); categoryRow.appendChild(b); }); }
function selectCategory(cat){ window.speechSynthesis && window.speechSynthesis.cancel(); state.category=cat; state.pool=(cat==='All')?QUESTIONS.slice():QUESTIONS.filter(q=>q.category===cat); renderCategories(); state.mode='sample'; showSampleForCategory(cat); }
function showSampleForCategory(cat){ const pool=(cat==='All')?QUESTIONS:QUESTIONS.filter(q=>q.category===cat); if(!pool.length){ questionText.textContent='No sample questions.'; optionsBox.innerHTML=''; hintArea.style.display='none'; return; } const s=pool[Math.floor(Math.random()*pool.length)]; displayQuestionToDOM(s, null, true); }

/* Prepare game */
function prepareGame(){ state.skipRemain=3; updateSkipLabel(); state.mode='game'; const pool=(state.category==='All')?QUESTIONS.slice():QUESTIONS.filter(q=>q.category===state.category); const shuffled=pool.sort(()=>Math.random()-0.5); state.game=shuffled.slice(0,5); state.selections=new Array(state.game.length).fill(-1); state.currentIndex=0; state.score=0; resultArea.style.display='none'; }

/* Display question: selection locked until Next pressed */
function displayQuestionToDOM(question, runIndex=null, sample=false){ const trans=(question.translations && (question.translations[state.lang]||question.translations['en']))? (question.translations[state.lang]||question.translations['en']) : {q:question.q, options:question.options, hint:question.hint}; questionText.textContent = trans.q; optionsBox.innerHTML=''; trans.options.forEach((opt,i)=>{ const div=document.createElement('div'); div.className='option'; div.tabIndex=0; div.dataset.index=i; div.innerHTML = `<span><strong>${String.fromCharCode(65+i)}.</strong> ${opt}</span><span class="feedback-icon" aria-hidden="true"></span>`; const handler = ()=>{ if(state.mode!=='game') { div.classList.add('selected'); setTimeout(()=>div.classList.remove('selected'),600); return; } if(state.selections[state.currentIndex]>=0) return; disableOptions(true); const correct = question.answer; const icon = div.querySelector('.feedback-icon'); if(parseInt(div.dataset.index)===correct){ div.classList.add('correct'); icon.textContent='‚úî'; } else { div.classList.add('wrong'); icon.textContent='‚úñ'; const correctEl = optionsBox.querySelector(`.option[data-index='${correct}']`); if(correctEl){ correctEl.classList.add('correct'); correctEl.querySelector('.feedback-icon').textContent='‚úî'; } } state.selections[state.currentIndex] = parseInt(div.dataset.index); recomputeScore(); if(nextBtn) nextBtn.disabled = false; disableOptions(false); }; div.addEventListener('click', handler, {passive:true}); div.addEventListener('keydown', (e)=>{ if(e.key==='Enter') handler(); }, {passive:true}); optionsBox.appendChild(div); }); hintArea.style.display='none'; hintArea.textContent=''; if(runIndex !== null){ qIndexEl.textContent = state.currentIndex + 1; runningScoreEl.textContent = state.score; progressBar.style.width = `${(state.currentIndex/state.game.length)*100}%`; prevBtn.disabled = state.currentIndex===0; nextBtn.disabled = state.selections[state.currentIndex] < 0 && state.selections[state.currentIndex] !== -2; } else { qIndexEl.textContent=0; runningScoreEl.textContent=0; progressBar.style.width='0%'; prevBtn.disabled=true; nextBtn.disabled=true; } }

function disableOptions(val){ Array.from(optionsBox.querySelectorAll('.option')).forEach(o=>{ o.classList.toggle('disabled', val); o.style.pointerEvents = val ? 'none' : ''; }); }
function renderQuestion(){ if(state.mode!=='game' || !state.game.length){ showSampleForCategory(state.category); return; } displayQuestionToDOM(state.game[state.currentIndex], state.currentIndex, false); }
function recomputeScore(){ let sc=0; for(let i=0;i<state.selections.length;i++){ if(state.selections[i]>=0 && state.selections[i]===state.game[i].answer) sc++; } state.score = sc; runningScoreEl.textContent = sc; }

function finishRun(){ recomputeScore(); const total = state.game.length, score = state.score; const rating = getRating(score,total); let html = `<div style="padding:12px;background:#fff;border-radius:8px">`; html += `<div style="display:flex;gap:12px;align-items:center"><div style="font-size:28px;font-weight:900;color:var(--green)">${score}/${total}</div><div><strong>${rating.title}</strong><div style="color:var(--muted)">${rating.text}</div></div></div><hr style="margin:10px 0">`; html += `<ol>`; state.game.forEach((q, idx)=>{ const t = q.translations[state.lang] || q.translations['en']; const sel = state.selections[idx]; const your = sel===-1 ? '<em>No answer</em>' : sel===-2 ? '<em>Skipped</em>' : t.options[sel]; const correct = t.options[q.answer]; const ok = (sel>=0 && sel===q.answer) ? '‚úÖ' : (sel===-2 ? '‚è≠Ô∏è' : '‚ùå'); html += `<li style="margin-bottom:12px"><div style="font-weight:700">${t.q}</div><div style="color:var(--muted)">Your: ${your} ¬∑ Correct: ${correct} ${ok}</div>`; if(t.hint) html += `<div style="margin-top:8px;padding:8px;background:#f7fff8;border-left:4px solid var(--green);border-radius:6px">${t.hint}</div>`; html += `</li>`; }); html += `</ol>`; html += `<div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap"><button id="retakeBtn" class="btn">Retake</button><button id="savePdfBtn" class="btn ghost">Save as PDF</button></div>`; html += `</div>`; resultArea.innerHTML = html; resultArea.style.display='block'; window.speechSynthesis && window.speechSynthesis.cancel(); setTimeout(()=>{ const rb=document.getElementById('retakeBtn'); if(rb) rb.addEventListener('click', ()=>{ prepareGame(); resultArea.style.display='none'; renderQuestion(); }); const sp=document.getElementById('savePdfBtn'); if(sp) sp.addEventListener('click', saveAsPDFPrompt); },60); }
function getRating(score,total){ const pct = score/total; if(pct===1) return {title:"Legend ‚Äî Nyota ya Historia!", text:"Perfect. You know Kenya inside-out."}; if(pct>=0.9) return {title:"Master ‚Äî Mtaalamu", text:"Almost perfect. Impressive knowledge."}; if(pct>=0.75) return {title:"Sharp", text:"Very good ‚Äî keep learning."}; if(pct>=0.5) return {title:"Rising Scholar", text:"Good effort ‚Äî you're getting there."}; return {title:"Friendly Beginner", text:"Nice try ‚Äî try again and read some fun facts."}; }

/* PDF */
function saveAsPDFPrompt(){ const custom = prompt("Add a custom message to appear at the top of your PDF (optional):", ""); if(custom===null) return; const content = `<div style="font-family:Arial;padding:18px"><h1>Kenya Trivia Results</h1><p>${escapeHtml(custom||'')}</p>` + resultArea.innerHTML + `</div>`; const w = window.open('','_blank'); w.document.write(content); w.document.close(); w.focus(); setTimeout(()=> w.print(),600); }
function escapeHtml(s){ return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

/* Skip */
function onSkip(){ if(state.mode!=='game' || !state.game.length) return; if(state.skipRemain<=0){ alert('No skips left this run.'); return; } const q=state.game[state.currentIndex]; state.selections[state.currentIndex] = -2; state.skipRemain--; updateSkipLabel(); Array.from(optionsBox.children).forEach(opt=>{ const idx=parseInt(opt.dataset.index); if(idx===q.answer) opt.classList.add('show-correct-skip'); else opt.classList.add('disabled'); }); if(nextBtn) nextBtn.disabled = false; }
function onHint(){ let q=null; if(state.mode==='game' && state.game.length) q = state.game[state.currentIndex]; else { const shown = questionText.textContent; q = QUESTIONS.find(item => (item.translations && (item.translations[state.lang]||item.translations['en']).q) === shown); } if(!q) return; const t = q.translations[state.lang] || q.translations['en']; if(hintArea.style.display==='none'){ hintArea.textContent = t.hint||''; hintArea.style.display='block'; } else { hintArea.style.display='none'; hintArea.textContent=''; } }

/* Carousel */
function renderFunFact(){ if(!FUNFACTS.length) return; const f = FUNFACTS[state.funIndex % FUNFACTS.length]; const text = f[state.lang] || f['en'] || ''; carouselCard.style.opacity = 0; setTimeout(()=>{ carouselCard.textContent = text; carouselCard.style.opacity = 1; },220); }
function startFunCarousel(){ stopFunCarousel(); state.funPlaying=true; state.funTimer = setInterval(()=>{ state.funIndex=(state.funIndex+1)%FUNFACTS.length; renderFunFact(); }, 4000); }
function stopFunCarousel(){ if(state.funTimer) clearInterval(state.funTimer); state.funTimer=null; state.funPlaying=false; }

/* Voice narration */
function speakCurrent(){ if(!('speechSynthesis' in window)) return; window.speechSynthesis.cancel(); let q=null; if(state.mode==='game' && state.game.length) q = state.game[state.currentIndex]; else { const shown = questionText.textContent; q = QUESTIONS.find(item => (item.translations && (item.translations[state.lang]||item.translations['en']).q) === shown); if(!q) return; } const t = q.translations[state.lang] || q.translations['en']; let text = t.q + '. '; t.options.forEach((o,i)=> text += `${String.fromCharCode(65+i)}. ${o}. `); const ut = new SpeechSynthesisUtterance(text); ut.lang = {en:'en-US', sw:'sw-KE', fr:'fr-FR', de:'de-DE', es:'es-ES', zh:'zh-CN', ar:'ar-SA', it:'it-IT'}[state.lang] || 'en-US'; const voices = window.speechSynthesis.getVoices(); const v = voices.find(x=> x.lang && x.lang.startsWith(ut.lang)); if(v) ut.voice = v; window.speechSynthesis.speak(ut); }

/* Keyboard */
function onOptionsKeydown(e){ const opts = Array.from(optionsBox.querySelectorAll('.option')); if(!opts.length) return; const active = document.activeElement; let idx = opts.indexOf(active); if(e.key === 'ArrowDown'){ e.preventDefault(); idx = (idx<opts.length-1)? idx+1 : 0; opts[idx].focus(); } if(e.key === 'ArrowUp'){ e.preventDefault(); idx = (idx>0)? idx-1 : opts.length-1; opts[idx].focus(); } if(e.key === 'Enter'){ e.preventDefault(); if(document.activeElement && document.activeElement.classList.contains('option')) document.activeElement.click(); } }
function globalKeydown(e){ if(e.key === 'ArrowLeft'){ if(state.mode==='game' && state.currentIndex>0){ state.currentIndex--; renderQuestion(); } } if(e.key === 'ArrowRight'){ if(state.mode==='game' && state.currentIndex < state.game.length-1){ state.currentIndex++; renderQuestion(); } } }

/* Forum */
function loadForum(){ return JSON.parse(localStorage.getItem('trivia_forum')||'[]'); }
function saveForum(f){ localStorage.setItem('trivia_forum', JSON.stringify(f)); }
function renderForum(){ const posts = loadForum(); forumList.innerHTML=''; if(!posts.length){ forumList.innerHTML = `<div class="small">${(UI[state.lang]||UI.en).forumIntro}</div>`; return; } posts.forEach(p=>{ const d=document.createElement('div'); d.className='post'; d.innerHTML = `<div style="font-weight:700">${escapeHtml(p.q)}</div><div class="small" style="color:var(--muted)">${escapeHtml(p.category)} ¬∑ ${new Date(p.date).toLocaleString()}</div>` + (p.ans?`<div style="margin-top:6px"><strong>Answer:</strong> ${escapeHtml(p.ans)}</div>`:'') + (p.replies && p.replies.length? `<div style="margin-top:6px"><em>Replies:</em><br>${p.replies.map(r=>escapeHtml(r)).join('<br>')}</div>`:''); const replyBtn=document.createElement('button'); replyBtn.className='btn ghost'; replyBtn.textContent='Reply'; replyBtn.addEventListener('click', ()=>{ const txt=prompt('Reply:'); if(txt){ p.replies=p.replies||[]; p.replies.push(txt); saveForum(posts); renderForum(); } }, {passive:true}); d.appendChild(replyBtn); forumList.appendChild(d); }); }
function onSubmitPost(){ const cat=(postCategory.value||'General').trim(); const q=(postQuestion.value||'').trim(); const a=(postAnswer.value||'').trim(); if(!q){ postMsg.textContent='Please enter a question or proverb.'; return; } const pending = JSON.parse(localStorage.getItem('pending_admin')||'[]'); pending.unshift({category:cat, q, ans:a, date:new Date().toISOString()}); localStorage.setItem('pending_admin', JSON.stringify(pending)); postMsg.textContent='Submitted to admin for review ‚Äî thank you!'; postCategory.value=''; postQuestion.value=''; postAnswer.value=''; }
function onPostForum(){ const cat=(postCategory.value||'General').trim(); const q=(postQuestion.value||'').trim(); const a=(postAnswer.value||'').trim(); if(!q){ postMsg.textContent='Enter a question to post to forum.'; return; } const posts = loadForum(); posts.unshift({id:Date.now().toString(), category:cat, q, ans:a, replies:[], date:new Date().toISOString()}); saveForum(posts); postMsg.textContent='Posted to forum.'; postCategory.value=''; postQuestion.value=''; postAnswer.value=''; renderForum(); }

/* Janjez chatbot */
const JAN_RESP = {
  greet: { en: "Habari! I can teach Swahili or Sheng phrases. Try: 'Teach me good morning'", sw: "Habari! Naweza kukufundisha Kiswahili au Sheng. Jaribu: 'Nifundishe asubuhi'" },
  goodmorning: { en: "Say 'Habari za asubuhi' or informally 'Mambo'", sw: "Sema 'Habari za asubuhi' au kwa fupi 'Mambo'" },
  shenggreet: { en: "Try: 'Niaje buda?' ‚Äî informal Sheng greeting meaning 'How are you, bro?'.", sw: "Jaribu: 'Niaje buda?' ‚Äî salamu ya Sheng" },
  harambee: { en: "Harambee means pull together ‚Äî a community call to help start projects and raise resources.", sw: "Harambee inamaanisha kufanya kazi pamoja." },
  unknownStrong: { en: "Haha, that's a good one ‚Äî I don't know it yet. Click 'Funza Janjez' to teach me.", sw: "Hiyo ni nzuri ‚Äî sijui bado. Bonyeza 'Funza Janjez' kunifundisha." },
  age: { en: "I'm timeless ‚Äî just code and curiosity.", sw: "Sina umri ‚Äî mimi ni msanidi programu." },
  father: { en: "Bojack Msafiri ‚Äî the greatest.", sw: "Bojack Msafiri ‚Äî bora kabisa." }
};

function appendJMessage(text, cls='jmsg'){ const d=document.createElement('div'); d.className = cls; d.style.margin='6px 0'; d.textContent = text; jchat.appendChild(d); while(jchat.children.length>400) jchat.removeChild(jchat.firstChild); jchat.scrollTop = jchat.scrollHeight; }
function onAskJanjez(){ const raw = (jinput.value||'').trim(); if(!raw) return; appendJMessage('You: ' + raw, 'jnote'); const key = raw.toLowerCase(); let reply = JAN_RESP.unknownStrong[state.lang] || JAN_RESP.unknownStrong.en; if(key.includes('good morning')||key.includes('asubuhi')) reply = JAN_RESP.goodmorning[state.lang] || JAN_RESP.goodmorning.en; if(key.includes('sheng') && key.includes('greet')) reply = JAN_RESP.shenggreet[state.lang] || JAN_RESP.shenggreet.en; if(key.includes('harambee')) reply = JAN_RESP.harambee[state.lang] || JAN_RESP.harambee.en; if(key.includes('age')) reply = JAN_RESP.age[state.lang] || JAN_RESP.age.en; if(key.includes('father')) reply = JAN_RESP.father[state.lang] || JAN_RESP.father.en; if(reply === (JAN_RESP.unknownStrong[state.lang] || JAN_RESP.unknownStrong.en)){ if(teachBtn) teachBtn.style.display='inline-block'; } appendJMessage('Janjez: ' + reply, 'jmsg'); jinput.value=''; }
function onTeachJanjez(){ const toTeach = prompt((state.lang==='sw')? 'Nifundishe nini?' : 'What should I learn?'); if(!toTeach) return; state.janjezLearned.push(toTeach.toLowerCase()); appendJMessage((state.lang==='sw')? 'Nimefundishwa: ' + toTeach : 'Learned: ' + toTeach, 'jmsg'); if(teachBtn) teachBtn.style.display='none'; }

/* Helpers */
function updateSkipLabel(){ const label = (state.lang==='sw')? 'Ruka' : 'Skip'; skipBtn.textContent = `${label} (${state.skipRemain}/3)`; }

</script>
</body>
</html>
